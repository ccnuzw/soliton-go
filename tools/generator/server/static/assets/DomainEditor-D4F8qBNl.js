import{d as Y,r as u,k as Z,o as ee,c as n,a,b as m,n as q,t as c,l as p,v as _,F as k,f as V,j as g,e as ae,p as x,q as te,s as le,i}from"./index-BYXHI-jq.js";import{a as w,_ as se}from"./_plugin-vue_export-helper-E7N84ePe.js";import{s as B,a as oe}from"./toast-CTjEvG5R.js";const ne={class:"editor"},ie={class:"tabs"},de={key:0,class:"domains-list"},ue={class:"search-box"},ce={key:0,class:"loading"},re={key:1,class:"empty"},ve={key:2,class:"empty"},me={key:3,class:"domain-grid"},pe=["onClick"],fe={class:"domain-header"},ye={class:"header-actions"},be={class:"badge"},ge=["onClick"],_e={class:"domain-fields"},ke={key:1},we={key:0,class:"editing-banner"},he={class:"layout"},Ce={class:"form-panel"},De={class:"form-group"},Ue={class:"fields-section"},Ve=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],Fe=["value"],Se=["value","onInput"],je=["onUpdate:modelValue"],Ne={class:"field-actions"},Pe=["onClick","disabled"],Oe=["onClick","disabled"],qe=["onClick","disabled"],xe={class:"options"},Te={class:"form-group inline"},Ee={"data-tooltip":"å¯ç”¨åå°†æ·»åŠ  DeletedAt å­—æ®µï¼Œåˆ é™¤æ—¶æ ‡è®°è€ŒéçœŸåˆ é™¤"},Be={class:"form-group inline"},Me={"data-tooltip":"è‡ªåŠ¨åœ¨ main.go ä¸­æ³¨å†Œæ­¤æ¨¡å—"},Ae={class:"form-group inline"},Ge={"data-tooltip":"è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶"},Ie={key:0,class:"force-warning"},Le={class:"advanced"},Re={class:"form-group"},Je={class:"form-group"},Qe={key:1,class:"error"},ze={class:"actions"},He=["disabled"],Ke=["disabled"],We={key:0,class:"preview-panel"},Xe={class:"preview-header"},Ye={class:"file-list"},Ze={class:"file-path"},ea={key:0,class:"message"},aa={class:"modal-message"},ta={class:"modal-actions"},la=Y({__name:"DomainEditor",setup(sa){const r=u(!1),v=u(null),f=u(""),h=u(!1),T=u([]),C=u([]),b=u("new"),j=u(!1),$=u(null),y=u(""),D=u(!1),U=u(null),s=u({name:"",fields:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!0,force:!1}),N=Z(()=>{if(!C.value||!y.value.trim())return C.value||[];const t=y.value.toLowerCase();return C.value.filter(e=>e.name.toLowerCase().includes(t)||e.fields.some(l=>l.toLowerCase().includes(t)))});ee(async()=>{try{const t=await w.getFieldTypes();T.value=t.types,await P()}catch(t){console.error(t)}});async function P(){j.value=!0;try{const t=await w.listDomains();C.value=t.domains}catch(t){console.error("Failed to load domains:",t)}finally{j.value=!1}}async function M(t,e){e.stopPropagation(),U.value=t,D.value=!0}async function A(){if(!U.value)return;const t=U.value;D.value=!1;try{await w.deleteDomain(t),await P(),B(`é¢†åŸŸæ¨¡å— "${t}" åˆ é™¤æˆåŠŸ`)}catch(e){oe(`åˆ é™¤å¤±è´¥: ${e.message}`)}finally{U.value=null}}async function G(t){r.value=!0,f.value="";try{const e=await w.getDomainDetail(t),l=e.fields.map(d=>{let o=I(d.type,d.is_enum);return{name:d.snake_name,type:o,comment:d.comment||"",enum_values:d.enum_values||[]}});s.value={name:e.name,fields:l.length>0?l:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!1,force:!0},$.value=t,b.value="new"}catch(e){f.value=`åŠ è½½å¤±è´¥: ${e.message}`}finally{r.value=!1}}function I(t,e){return e?"enum":(t=t.replace("*",""),t==="string"?"string":t==="int"?"int":t==="int64"?"int64":t==="float64"?"float64":t==="bool"?"bool":t==="time.Time"?"time":t.includes("Time")?"time?":t==="datatypes.JSON"?"json":t==="[]byte"?"bytes":"enum")}function L(){s.value.fields.push({name:"",type:"string",comment:"",enum_values:[]})}function R(t){s.value.fields.length>1&&s.value.fields.splice(t,1)}function J(t){if(t>0){const e=s.value.fields,l=e.splice(t,1)[0];e.splice(t-1,0,l)}}function Q(t){const e=s.value.fields;if(t<e.length-1){const l=e.splice(t,1)[0];e.splice(t+1,0,l)}}function z(t,e){t.enum_values=e.split("|").map(l=>l.trim()).filter(Boolean)}async function H(){f.value="",r.value=!0;try{const t=s.value.fields.filter(e=>e.name.trim());v.value=await w.previewDomain({...s.value,fields:t}),h.value=!0}catch(t){f.value=t.message}finally{r.value=!1}}async function K(){f.value="",r.value=!0,O.value=!1,F.value="",S.value="";try{const t=s.value.fields.filter(e=>e.name&&e.type);v.value=await w.generateDomain({...s.value,fields:t}),h.value=!0,await P(),v.value.success&&(B(v.value.message||"ç”ŸæˆæˆåŠŸï¼"),await W())}catch(t){f.value=t.message}finally{r.value=!1}}const O=u(!1),F=u(""),S=u("");async function W(){O.value=!0,F.value="",S.value="";try{const l=(await(await fetch("/api/layout")).json()).module_dir||".";console.log("Running go mod tidy for:",l);const o=await(await fetch("/api/projects/tidy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_path:l})})).json();console.log("Tidy result:",o),o.success?F.value=o.message||"ä¾èµ–ä¸‹è½½æˆåŠŸ":(S.value=o.error||"ä¾èµ–ä¸‹è½½å¤±è´¥",o.output&&(F.value=o.output))}catch(t){console.error("Tidy error:",t),S.value=`ä¾èµ–ä¸‹è½½å¤±è´¥: ${t.message}`}finally{O.value=!1}}function E(){s.value={name:"",fields:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!0,force:!1},v.value=null,h.value=!1,$.value=null}function X(t){return{new:"æ–°å»º",overwrite:"è¦†ç›–",skip:"è·³è¿‡",error:"é”™è¯¯"}[t]||t}return(t,e)=>(i(),n(k,null,[a("div",ne,[e[28]||(e[28]=a("h1",null,"ğŸ“¦ ç”Ÿæˆé¢†åŸŸæ¨¡å— Domain",-1)),a("div",ie,[a("button",{class:q(["tab",{active:b.value==="new"}]),onClick:e[0]||(e[0]=l=>b.value="new")}," âœ¨ æ–°å»ºæ¨¡å— ",2),a("button",{class:q(["tab",{active:b.value==="existing"}]),onClick:e[1]||(e[1]=l=>b.value="existing")}," ğŸ“‹ å·²ç”Ÿæˆæ¨¡å— ("+c(C.value?.length||0)+") ",3)]),b.value==="existing"?(i(),n("div",de,[a("div",ue,[p(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),type:"text",placeholder:"ğŸ” æœç´¢é¢†åŸŸæ¨¡å—æˆ–å­—æ®µ...",class:"search-input"},null,512),[[_,y.value]]),y.value?(i(),n("span",{key:0,class:"search-clear",onClick:e[3]||(e[3]=l=>y.value="")},"âœ•")):m("",!0)]),j.value?(i(),n("div",ce,"åŠ è½½ä¸­...")):N.value.length===0&&!y.value?(i(),n("div",re,[...e[14]||(e[14]=[a("p",null,"æš‚æ— å·²ç”Ÿæˆçš„é¢†åŸŸæ¨¡å—",-1),a("p",{class:"hint"},'ç‚¹å‡»"æ–°å»ºæ¨¡å—"å¼€å§‹åˆ›å»º',-1)])])):N.value.length===0&&y.value?(i(),n("div",ve,[...e[15]||(e[15]=[a("p",null,"æœªæ‰¾åˆ°åŒ¹é…çš„æ¨¡å—",-1),a("p",{class:"hint"},"å°è¯•å…¶ä»–å…³é”®è¯",-1)])])):(i(),n("div",me,[(i(!0),n(k,null,V(N.value,l=>(i(),n("div",{key:l.name,class:"domain-card",onClick:d=>G(l.name)},[a("div",fe,[a("h3",null,c(l.name),1),a("div",ye,[a("span",be,c(l.fields?.length||0)+" å­—æ®µ",1),a("button",{class:"btn-delete",onClick:d=>M(l.name,d),title:"åˆ é™¤æ¨¡å—"}," ğŸ—‘ï¸ ",8,ge)])]),a("div",_e,[(i(!0),n(k,null,V(l.fields,(d,o)=>(i(),n("span",{key:o,class:"field-tag"},c(d),1))),128))]),e[16]||(e[16]=a("div",{class:"domain-action"}," ç‚¹å‡»ç¼–è¾‘ â†’ ",-1))],8,pe))),128))]))])):m("",!0),b.value==="new"?(i(),n("div",ke,[$.value?(i(),n("div",we,[e[17]||(e[17]=g(" âœï¸ æ­£åœ¨ç¼–è¾‘: ",-1)),a("strong",null,c($.value),1),a("button",{class:"btn-small",onClick:E},"å–æ¶ˆç¼–è¾‘")])):m("",!0),a("div",he,[a("div",Ce,[e[27]||(e[27]=ae('<details class="help-tips" data-v-7733ac66><summary data-v-7733ac66>ğŸ“– ä½¿ç”¨æŒ‡å— Usage Guide</summary><div class="tips-content" data-v-7733ac66><p data-v-7733ac66><strong data-v-7733ac66>é¢†åŸŸåç§°ï¼š</strong>ä½¿ç”¨ PascalCase æ ¼å¼ï¼Œå¦‚ <code data-v-7733ac66>User</code>ã€<code data-v-7733ac66>Order</code>ã€<code data-v-7733ac66>Product</code></p><p data-v-7733ac66><strong data-v-7733ac66>å­—æ®µç±»å‹ï¼š</strong></p><ul data-v-7733ac66><li data-v-7733ac66><code data-v-7733ac66>string</code> - å­—ç¬¦ä¸² (varchar 255)</li><li data-v-7733ac66><code data-v-7733ac66>text</code> - é•¿æ–‡æœ¬ (æ— é•¿åº¦é™åˆ¶)</li><li data-v-7733ac66><code data-v-7733ac66>int</code> - 32ä½æ•´æ•°</li><li data-v-7733ac66><code data-v-7733ac66>int64</code> - 64ä½æ•´æ•° (é€‚åˆé‡‘é¢ã€å¤§æ•°å€¼)</li><li data-v-7733ac66><code data-v-7733ac66>float64</code> - æµ®ç‚¹æ•° (é€‚åˆè¯„åˆ†ã€é‡é‡ç­‰)</li><li data-v-7733ac66><code data-v-7733ac66>decimal</code> - ç²¾ç¡®å°æ•° (é€‚åˆé‡‘é¢ï¼Œç²¾åº¦ 10,2)</li><li data-v-7733ac66><code data-v-7733ac66>bool</code> - å¸ƒå°”å€¼ (true/false)</li><li data-v-7733ac66><code data-v-7733ac66>time</code> - å¿…å¡«æ—¶é—´æˆ³</li><li data-v-7733ac66><code data-v-7733ac66>time?</code> - å¯é€‰æ—¶é—´æˆ³ (å¯ä¸ºç©º)</li><li data-v-7733ac66><code data-v-7733ac66>date</code> - æ—¥æœŸ (æ— æ—¶é—´éƒ¨åˆ†)</li><li data-v-7733ac66><code data-v-7733ac66>date?</code> - å¯é€‰æ—¥æœŸ</li><li data-v-7733ac66><code data-v-7733ac66>uuid</code> - UUID å­—ç¬¦ä¸² (å¸¦ç´¢å¼•ï¼Œé€‚åˆå¤–é”®)</li><li data-v-7733ac66><code data-v-7733ac66>json</code> - JSON å¯¹è±¡ (éœ€ gorm.io/datatypes)</li><li data-v-7733ac66><code data-v-7733ac66>jsonb</code> - JSONB (PostgreSQL ä¸“ç”¨)</li><li data-v-7733ac66><code data-v-7733ac66>bytes</code> - äºŒè¿›åˆ¶æ•°æ®</li><li data-v-7733ac66><code data-v-7733ac66>enum</code> - æšä¸¾ç±»å‹ï¼Œéœ€å¡«å†™æšä¸¾å€¼ï¼ˆç”¨ <code data-v-7733ac66>|</code> åˆ†éš”ï¼Œå¦‚ <code data-v-7733ac66>active|inactive|banned</code>ï¼‰</li></ul><p data-v-7733ac66><strong data-v-7733ac66>å­—æ®µå¤‡æ³¨ï¼š</strong>å¯é€‰ï¼Œå¡«å†™åä¼šä½œä¸ºä»£ç æ³¨é‡Šç”Ÿæˆåœ¨å­—æ®µå®šä¹‰è¡Œæœ«</p><p data-v-7733ac66><strong data-v-7733ac66>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul data-v-7733ac66><li data-v-7733ac66><code data-v-7733ac66>ID</code>ã€<code data-v-7733ac66>CreatedAt</code>ã€<code data-v-7733ac66>UpdatedAt</code> å­—æ®µè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ </li><li data-v-7733ac66>å¯ç”¨&quot;è½¯åˆ é™¤&quot;ä¼šè‡ªåŠ¨æ·»åŠ  <code data-v-7733ac66>DeletedAt</code> å­—æ®µ</li><li data-v-7733ac66>ä½¿ç”¨ â†‘â†“ æŒ‰é’®å¯è°ƒæ•´å­—æ®µé¡ºåº</li><li data-v-7733ac66>å‹¾é€‰&quot;å¼ºåˆ¶è¦†ç›–&quot;ä¼šå®Œå…¨æ›¿æ¢ç°æœ‰ä»£ç ï¼Œè¯·è°¨æ…ä½¿ç”¨</li><li data-v-7733ac66>å‹¾é€‰&quot;è‡ªåŠ¨æ³¨å…¥&quot;ä¼šå°†æ¨¡å—æ³¨å…¥åˆ° main.go</li><li data-v-7733ac66>ç”Ÿæˆåä¼šè‡ªåŠ¨è¿è¡Œ <code data-v-7733ac66>go mod tidy</code> ä¸‹è½½ä¾èµ–</li><li data-v-7733ac66>Value Object / Specification / Policy / Event ç›¸å…³åŠŸèƒ½è¯·å‰å¾€ã€Œé¢†åŸŸå¢å¼ºã€</li></ul></div></details>',1)),a("div",De,[e[18]||(e[18]=a("label",null,[g(" é¢†åŸŸåç§° Domain Name * "),a("span",{class:"tooltip","data-tooltip":"å®ä½“åç§°ï¼Œå°†ç”Ÿæˆå¯¹åº”çš„ Go ç»“æ„ä½“"},"â“˜")],-1)),p(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.name=l),placeholder:"User / Order / Product"},null,512),[[_,s.value.name]])]),a("div",Ue,[a("div",{class:"section-header"},[e[19]||(e[19]=a("h3",null,"å­—æ®µ Fields",-1)),a("button",{class:"btn-add",onClick:L},"+ æ·»åŠ å­—æ®µ")]),(i(!0),n(k,null,V(s.value.fields,(l,d)=>(i(),n("div",{class:"field-row",key:d},[p(a("input",{"onUpdate:modelValue":o=>l.name=o,placeholder:"username / email / status",class:"field-name"},null,8,Ve),[[_,l.name]]),p(a("select",{"onUpdate:modelValue":o=>l.type=o,class:"field-type"},[(i(!0),n(k,null,V(T.value,o=>(i(),n("option",{key:o.type,value:o.type},c(o.type)+" - "+c(o.description),9,Fe))),128))],8,$e),[[le,l.type]]),l.type==="enum"?(i(),n("input",{key:0,value:l.enum_values?.join("|"),onInput:o=>z(l,o.target.value),placeholder:"active|inactive|banned",class:"field-enum","data-tooltip":"æšä¸¾å€¼ç”¨ | åˆ†éš”ï¼Œå¦‚ï¼šactive|inactive"},null,40,Se)):m("",!0),p(a("input",{"onUpdate:modelValue":o=>l.comment=o,placeholder:"å­—æ®µå¤‡æ³¨",class:"field-comment"},null,8,je),[[_,l.comment]]),a("div",Ne,[a("button",{class:"btn-move",onClick:o=>J(d),disabled:d===0,title:"ä¸Šç§»"},"â†‘",8,Pe),a("button",{class:"btn-move",onClick:o=>Q(d),disabled:d===s.value.fields.length-1,title:"ä¸‹ç§»"},"â†“",8,Oe),a("button",{class:"btn-remove",onClick:o=>R(d),disabled:s.value.fields.length===1},"Ã—",8,qe)])]))),128))]),a("div",xe,[a("div",Te,[a("label",Ee,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.soft_delete=l)},null,512),[[x,s.value.soft_delete]]),e[20]||(e[20]=g(" å¯ç”¨è½¯åˆ é™¤ Soft Delete ",-1))])]),a("div",Be,[a("label",Me,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>s.value.wire=l)},null,512),[[x,s.value.wire]]),e[21]||(e[21]=g(" è‡ªåŠ¨æ³¨å…¥åˆ° main.go ",-1))])]),a("div",Ae,[a("label",Ge,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>s.value.force=l)},null,512),[[x,s.value.force]]),e[22]||(e[22]=g(" å¼ºåˆ¶è¦†ç›– Force ",-1))])])]),s.value.force?(i(),n("div",Ie,[...e[23]||(e[23]=[a("div",{class:"warning-icon"},"âš ï¸",-1),a("div",{class:"warning-content"},[a("strong",null,"è­¦å‘Šï¼šå¼ºåˆ¶è¦†ç›–å°†æ°¸ä¹…åˆ é™¤æ‰€æœ‰æ‰‹åŠ¨ä¿®æ”¹çš„ä»£ç ï¼"),a("p",null,"åªåœ¨é¦–æ¬¡ç”Ÿæˆåç«‹å³ä¿®æ”¹å­—æ®µæ—¶ä½¿ç”¨ã€‚ä¸€æ—¦å¼€å§‹å†™ä¸šåŠ¡é€»è¾‘ï¼Œè¯·å‹¿å‹¾é€‰æ­¤é€‰é¡¹ã€‚")],-1)])])):m("",!0),a("details",Le,[e[26]||(e[26]=a("summary",null,"é«˜çº§é€‰é¡¹ Advanced",-1)),a("div",Re,[e[24]||(e[24]=a("label",null,"è‡ªå®šä¹‰è¡¨å Table Name",-1)),p(a("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.table_name=l),placeholder:"ï¼ˆè‡ªåŠ¨ï¼šåç§°çš„å¤æ•°å½¢å¼ï¼‰"},null,512),[[_,s.value.table_name]])]),a("div",Je,[e[25]||(e[25]=a("label",null,"è‡ªå®šä¹‰è·¯ç”±å‰ç¼€ Route Base",-1)),p(a("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.route_base=l),placeholder:"ï¼ˆè‡ªåŠ¨ï¼šåç§°çš„å¤æ•°å½¢å¼ï¼‰"},null,512),[[_,s.value.route_base]])])]),f.value?(i(),n("div",Qe,c(f.value),1)):m("",!0),a("div",ze,[a("button",{class:"btn",onClick:H,disabled:!s.value.name||r.value},c(r.value?"åŠ è½½ä¸­...":"é¢„è§ˆ Preview"),9,He),a("button",{class:"btn primary",onClick:K,disabled:!s.value.name||r.value},c(r.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆ Generate"),9,Ke)])]),h.value&&v.value?(i(),n("div",We,[a("div",Xe,[a("h3",null,c(v.value.success?"âœ… å·²ç”Ÿæˆæ–‡ä»¶":"âŒ é”™è¯¯"),1),a("button",{class:"btn-close",onClick:e[10]||(e[10]=l=>h.value=!1)},"Ã—")]),a("div",Ye,[(i(!0),n(k,null,V(v.value.files,l=>(i(),n("div",{class:"file",key:l.path},[a("span",{class:q(["file-status",l.status])},c(X(l.status)),3),a("span",Ze,c(l.path.split("/").pop()),1)]))),128))]),v.value.message?(i(),n("div",ea,c(v.value.message),1)):m("",!0),a("button",{class:"btn primary",onClick:E,style:{width:"100%","margin-top":"16px"}}," ç”Ÿæˆå¦ä¸€ä¸ª ")])):m("",!0)])])):m("",!0)]),D.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:e[13]||(e[13]=l=>D.value=!1)},[a("div",{class:"modal-dialog",onClick:e[12]||(e[12]=te(()=>{},["stop"]))},[e[31]||(e[31]=a("div",{class:"modal-icon"},"âš ï¸",-1)),e[32]||(e[32]=a("h3",null,"ç¡®è®¤åˆ é™¤",-1)),a("p",aa,[e[29]||(e[29]=g(" ç¡®å®šè¦åˆ é™¤é¢†åŸŸæ¨¡å— ",-1)),a("strong",null,'"'+c(U.value)+'"',1),e[30]||(e[30]=g(" å—ï¼Ÿ ",-1))]),e[33]||(e[33]=a("p",{class:"modal-warning"}," è¿™å°†åˆ é™¤æ•´ä¸ªç›®å½•åŠå…¶æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼ ",-1)),a("div",ta,[a("button",{class:"btn",onClick:e[11]||(e[11]=l=>D.value=!1)},"å–æ¶ˆ"),a("button",{class:"btn danger",onClick:A},"ç¡®è®¤åˆ é™¤")])])])):m("",!0)],64))}}),da=se(la,[["__scopeId","data-v-7733ac66"]]);export{da as default};
