import{d as et,r as o,k as V,o as st,c as a,a as e,b as B,t as n,j as u,l as v,p as m,v as Y,n as E,F as G,f as J,q as lt,i}from"./index-B6d2u8uR.js";import{a as q,_ as nt}from"./_plugin-vue_export-helper-C3QuQZpn.js";import{a as _,s as z}from"./toast-ijgLvE2V.js";const ot={class:"page"},at={class:"header"},it=["disabled"],ut={class:"panel"},rt={key:0,class:"hint"},dt={key:1,class:"hint error"},vt={key:2,class:"project-info"},ct={class:"hint"},mt={class:"panel grid"},pt={class:"card"},ft={class:"checkbox"},yt={class:"checkbox"},bt={class:"form-group"},gt={class:"form-group"},kt={class:"card"},xt={class:"checkbox"},ht={class:"checkbox"},_t={class:"checkbox"},Ct={class:"checkbox"},wt={class:"checkbox"},Mt={class:"panel"},$t={class:"panel-header"},Rt={class:"status"},Lt={key:1,class:"hint"},St={class:"meta"},Ut={class:"meta"},Tt={class:"log-panel"},Vt={key:0,class:"hint"},Et={class:"log-time"},It={class:"log-step"},Dt={class:"log-level"},Ot={class:"log-message"},jt={class:"panel"},Nt={key:0,class:"hint"},Ft={key:1,class:"history-list"},Ht=["onClick"],At={class:"hint"},Bt={class:"modal-actions"},Yt=et({__name:"MigrationCenter",setup(Gt){const f=o(null),I=o(!0),b=o(!1),c=o(null),p=o([]),r=o([]),g=o(!0),k=o(300),C=o(5),w=o(!0),M=o(!0),$=o(!0),R=o(!0),L=o(!0),S=o(!0),y=o(!1),D=V(()=>p.value.filter(l=>!(l.level==="error"&&!$.value||l.level!=="error"&&!M.value||l.step==="system"&&!R.value||l.step==="tidy"&&!L.value||l.step==="migrate"&&!S.value))),x=V(()=>f.value?.module_dir||""),P=V(()=>"é»˜è®¤ä½¿ç”¨ cmd/migrate/main.goï¼›è‹¥ä¸å­˜åœ¨åˆ™å›é€€ cmd/migrate.go");st(async()=>{await K(),Q(),I.value=!1});async function K(){try{f.value=await q.getLayout()}catch(l){console.error(l)}}function Q(){const l=localStorage.getItem("soliton-gen:migration-history");if(l)try{const t=JSON.parse(l);if(Array.isArray(t)&&(r.value=t,r.value.length>0)){const s=r.value[0];s&&j(s)}}catch(t){console.error("Failed to parse history:",t)}}function O(){localStorage.setItem("soliton-gen:migration-history",JSON.stringify(r.value))}function j(l){c.value=l,p.value=l.logs||[]}function N(){p.value=[],c.value=null}function W(){r.value=[],O(),N()}function F(l){return l?new Date(l).toLocaleString():"-"}function H(l){if(!l)return"-";const t=Math.floor(l/1e3),s=Math.floor(t/60),d=t%60;return s>0?`${s}m ${d}s`:`${d}s`}function U(l){return l==="error"?"ERROR":"INFO"}function T(l){return l==="tidy"?"TIDY":l==="migrate"?"MIGRATE":"SYSTEM"}async function X(){if(!f.value?.found||!x.value){_("æœªæ£€æµ‹åˆ°é¡¹ç›®ï¼Œè¯·å…ˆåˆå§‹åŒ–æˆ–åˆ‡æ¢é¡¹ç›®");return}if(w.value){y.value=!0;return}await A()}async function A(){y.value=!1,b.value=!0;try{const l=await q.runMigration(x.value,g.value,k.value),t={...l,id:`${Date.now()}`};c.value=t,p.value=l.logs||[],r.value=[t,...r.value].slice(0,C.value),O(),l.success?z(l.message||"è¿ç§»å®Œæˆ"):_(l.message||"è¿ç§»å¤±è´¥")}catch(l){_(l.message||"è¿ç§»å¤±è´¥")}finally{b.value=!1}}async function Z(){const l=p.value.map(t=>`[${t.time}] [${T(t.step)}] [${U(t.level)}] ${t.message}`).join(`
`);try{await navigator.clipboard.writeText(l),z("æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(t){_(`å¤åˆ¶å¤±è´¥: ${t.message}`)}}function tt(){const l=p.value.map(h=>`[${h.time}] [${T(h.step)}] [${U(h.level)}] ${h.message}`).join(`
`),t=new Blob([l],{type:"text/plain"}),s=URL.createObjectURL(t),d=document.createElement("a");d.href=s,d.download=`migration-log-${Date.now()}.txt`,d.click(),URL.revokeObjectURL(s)}return(l,t)=>(i(),a("div",ot,[e("header",at,[t[12]||(t[12]=e("div",null,[e("h1",null,"ğŸ› ï¸ è¿ç§»ä¸­å¿ƒ Migration Center"),e("p",{class:"subtitle"},"å®Œæ•´è¿ç§»æµç¨‹ + è¯¦ç»†æ—¥å¿—ï¼Œé€‚åˆéƒ¨ç½²æˆ–æ—¥å¸¸ç»´æŠ¤")],-1)),e("button",{class:"btn primary",disabled:b.value,onClick:X},n(b.value?"è¿ç§»æ‰§è¡Œä¸­...":"å¼€å§‹è¿ç§»"),9,it)]),e("section",ut,[t[15]||(t[15]=e("h2",null,"é¡¹ç›®ä¿¡æ¯",-1)),I.value?(i(),a("div",rt,"åŠ è½½é¡¹ç›®ä¸­...")):f.value?.found?(i(),a("div",vt,[e("div",null,[t[13]||(t[13]=e("strong",null,"æ¨¡å—è·¯å¾„ï¼š",-1)),u(n(f.value?.module_path),1)]),e("div",null,[t[14]||(t[14]=e("strong",null,"é¡¹ç›®è·¯å¾„ï¼š",-1)),u(n(x.value),1)]),e("div",ct,n(P.value),1)])):(i(),a("div",dt,"æœªæ£€æµ‹åˆ°é¡¹ç›®ï¼Œè¯·å…ˆåˆå§‹åŒ–æˆ–åˆ‡æ¢é¡¹ç›®"))]),e("section",mt,[e("div",pt,[t[22]||(t[22]=e("h3",null,"è¿è¡Œè®¾ç½®",-1)),e("label",ft,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s)},null,512),[[m,g.value]]),t[16]||(t[16]=u(" è¿ç§»å‰æ‰§è¡Œ go mod tidy ",-1))]),e("label",yt,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s)},null,512),[[m,w.value]]),t[17]||(t[17]=u(" æ‰§è¡Œå‰äºŒæ¬¡ç¡®è®¤ ",-1))]),e("div",bt,[t[18]||(t[18]=e("label",null,"è¶…æ—¶ (ç§’)",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),min:"60",max:"1800"},null,512),[[Y,k.value,void 0,{number:!0}]]),t[19]||(t[19]=e("span",{class:"hint"},"å»ºè®® 300-600 ç§’ï¼Œè¶…æ—¶æ—¶ä¼šè‡ªåŠ¨ä¸­æ–­",-1))]),e("div",gt,[t[20]||(t[20]=e("label",null,"ä¿ç•™å†å²è®°å½•æ•°",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),min:"1",max:"20"},null,512),[[Y,C.value,void 0,{number:!0}]]),t[21]||(t[21]=e("span",{class:"hint"},"ä¿ç•™æœ€è¿‘å‡ æ¬¡è¿ç§»æ—¥å¿—ï¼Œä¿å­˜åœ¨æµè§ˆå™¨",-1))])]),e("div",kt,[t[28]||(t[28]=e("h3",null,"æ—¥å¿—ç­›é€‰",-1)),e("label",xt,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=s=>M.value=s)},null,512),[[m,M.value]]),t[23]||(t[23]=u(" æ˜¾ç¤º INFO ",-1))]),e("label",ht,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>$.value=s)},null,512),[[m,$.value]]),t[24]||(t[24]=u(" æ˜¾ç¤º ERROR ",-1))]),e("label",_t,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>R.value=s)},null,512),[[m,R.value]]),t[25]||(t[25]=u(" æ˜¾ç¤º SYSTEM ",-1))]),e("label",Ct,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>L.value=s)},null,512),[[m,L.value]]),t[26]||(t[26]=u(" æ˜¾ç¤º TIDY ",-1))]),e("label",wt,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=s=>S.value=s)},null,512),[[m,S.value]]),t[27]||(t[27]=u(" æ˜¾ç¤º MIGRATE ",-1))]),e("div",{class:"actions"},[e("button",{class:"btn",onClick:Z},"å¤åˆ¶æ—¥å¿—"),e("button",{class:"btn",onClick:tt},"ä¸‹è½½æ—¥å¿—"),e("button",{class:"btn danger",onClick:N},"æ¸…ç©ºå½“å‰")])])]),e("section",Mt,[e("div",$t,[t[29]||(t[29]=e("h2",null,"è¿ç§»æ—¥å¿—",-1)),e("div",Rt,[c.value?(i(),a("span",{key:0,class:E(c.value.success?"ok":"fail")},n(c.value.success?"æˆåŠŸ":"å¤±è´¥"),3)):(i(),a("span",Lt,"æš‚æ— è¿è¡Œè®°å½•")),e("span",St,"è€—æ—¶: "+n(H(c.value?.duration_ms||0)),1),e("span",Ut,"ExitCode: "+n(c.value?.exit_code??"-"),1)])]),e("div",Tt,[D.value.length===0?(i(),a("div",Vt,"æš‚æ— æ—¥å¿—")):B("",!0),(i(!0),a(G,null,J(D.value,(s,d)=>(i(),a("div",{key:d,class:E(["log-line",s.level])},[e("span",Et,n(F(s.time)),1),e("span",It,n(T(s.step)),1),e("span",Dt,n(U(s.level)),1),e("span",Ot,n(s.message),1)],2))),128))])]),e("section",jt,[e("div",{class:"panel-header"},[t[30]||(t[30]=e("h2",null,"å†å²è®°å½•",-1)),e("button",{class:"btn danger",onClick:W},"æ¸…ç©ºå†å²")]),r.value.length===0?(i(),a("div",Nt,"æš‚æ— å†å²è®°å½•")):(i(),a("div",Ft,[(i(!0),a(G,null,J(r.value,s=>(i(),a("button",{key:s.id,class:"history-item",onClick:d=>j(s)},[e("div",null,[e("strong",null,n(F(s.started_at)),1),e("span",{class:E(s.success?"ok":"fail")},n(s.success?"æˆåŠŸ":"å¤±è´¥"),3)]),e("div",At,"è€—æ—¶: "+n(H(s.duration_ms))+" Â· "+n(s.command),1)],8,Ht))),128))]))]),y.value?(i(),a("div",{key:0,class:"modal-overlay",onClick:t[11]||(t[11]=s=>y.value=!1)},[e("div",{class:"modal",onClick:t[10]||(t[10]=lt(()=>{},["stop"]))},[t[34]||(t[34]=e("h3",null,"ç¡®è®¤æ‰§è¡Œè¿ç§»",-1)),e("p",null,[t[31]||(t[31]=u("é¡¹ç›®è·¯å¾„ï¼š",-1)),e("code",null,n(x.value),1)]),t[35]||(t[35]=e("p",null,[u("æ‰§è¡Œå‘½ä»¤ï¼š"),e("code",null,"go run ./cmd/migrate")],-1)),e("p",null,[t[32]||(t[32]=u("å‰ç½® tidyï¼š",-1)),e("strong",null,n(g.value?"æ˜¯":"å¦"),1)]),e("p",null,[t[33]||(t[33]=u("è¶…æ—¶è®¾ç½®ï¼š",-1)),e("strong",null,n(k.value)+" ç§’",1)]),e("div",Bt,[e("button",{class:"btn",onClick:t[9]||(t[9]=s=>y.value=!1)},"å–æ¶ˆ"),e("button",{class:"btn primary",onClick:A},"ç¡®è®¤æ‰§è¡Œ")])])])):B("",!0)]))}}),Pt=nt(Yt,[["__scopeId","data-v-e85b3eb4"]]);export{Pt as default};
