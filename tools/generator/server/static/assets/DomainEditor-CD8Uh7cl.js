import{d as Y,r as u,k as Z,o as ee,c as o,a as t,b as f,n as E,t as r,l as m,v as U,F as b,f as V,j as _,e as te,p as M,q as ae,s as le,i as n}from"./index-DydibX5v.js";import{a as k,_ as se}from"./_plugin-vue_export-helper-1WfN36Ns.js";import{s as O,a as oe}from"./toast-SFpT3Opn.js";const ne={class:"editor"},ie={class:"tabs"},de={key:0,class:"domains-list"},ue={class:"search-box"},re={key:0,class:"loading"},ve={key:1,class:"empty"},ce={key:2,class:"empty"},fe={key:3,class:"domain-grid"},me=["onClick"],pe={class:"domain-header"},ye={class:"header-actions"},ge={class:"badge"},_e=["onClick"],be={class:"domain-fields"},ke={key:1},we={key:0,class:"editing-banner"},he={class:"layout"},Ce={class:"form-panel"},De={class:"form-group"},Ue={class:"fields-section"},Ve=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],Fe=["value"],Te=["value","onInput"],je={class:"field-actions"},Ne=["onClick","disabled"],Se=["onClick","disabled"],Pe=["onClick","disabled"],Ee={class:"options"},Me={class:"form-group inline"},Be={"data-tooltip":"å¯ç”¨åå°†æ·»åŠ  DeletedAt å­—æ®µï¼Œåˆ é™¤æ—¶æ ‡è®°è€ŒéçœŸåˆ é™¤"},Ge={class:"form-group inline"},Oe={"data-tooltip":"è‡ªåŠ¨åœ¨ main.go ä¸­æ³¨å†Œæ­¤æ¨¡å—"},Re={class:"form-group inline"},qe={"data-tooltip":"è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶"},xe={key:0,class:"force-warning"},Ae={class:"advanced"},Ie={class:"form-group"},Le={class:"form-group"},ze={key:1,class:"error"},Je={class:"actions"},Qe=["disabled"],He=["disabled"],Ke={key:0,class:"preview-panel"},We={class:"preview-header"},Xe={class:"file-list"},Ye={class:"file-path"},Ze={key:0,class:"message"},et={class:"modal-message"},tt={class:"modal-actions"},at=Y({__name:"DomainEditor",setup(lt){const v=u(!1),c=u(null),p=u(""),w=u(!1),B=u([]),h=u([]),g=u("new"),j=u(!1),$=u(null),y=u(""),C=u(!1),D=u(null),s=u({name:"",fields:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!0,force:!1}),N=Z(()=>{if(!h.value||!y.value.trim())return h.value||[];const a=y.value.toLowerCase();return h.value.filter(e=>e.name.toLowerCase().includes(a)||e.fields.some(l=>l.toLowerCase().includes(a)))});ee(async()=>{try{const a=await k.getFieldTypes();B.value=a.types,await S()}catch(a){console.error(a)}});async function S(){j.value=!0;try{const a=await k.listDomains();h.value=a.domains}catch(a){console.error("Failed to load domains:",a)}finally{j.value=!1}}async function R(a,e){e.stopPropagation(),D.value=a,C.value=!0}async function q(){if(!D.value)return;const a=D.value;C.value=!1;try{await k.deleteDomain(a),await S(),O(`é¢†åŸŸæ¨¡å— "${a}" åˆ é™¤æˆåŠŸ`)}catch(e){oe(`åˆ é™¤å¤±è´¥: ${e.message}`)}finally{D.value=null}}async function x(a){v.value=!0,p.value="";try{const e=await k.getDomainDetail(a),l=e.fields.map(d=>{let i=A(d.type);return{name:d.snake_name,type:i,enum_values:d.is_enum?[]:void 0}});s.value={name:e.name,fields:l.length>0?l:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!1,force:!0},$.value=a,g.value="new"}catch(e){p.value=`åŠ è½½å¤±è´¥: ${e.message}`}finally{v.value=!1}}function A(a){return a=a.replace("*",""),a==="string"?"string":a==="int"?"int":a==="int64"?"int64":a==="float64"?"float64":a==="bool"?"bool":a==="time.Time"?"time":a.includes("Time")?"time?":"enum"}function I(){s.value.fields.push({name:"",type:"string",enum_values:[]})}function L(a){s.value.fields.length>1&&s.value.fields.splice(a,1)}function z(a){if(a>0){const e=s.value.fields;[e[a-1],e[a]]=[e[a],e[a-1]]}}function J(a){const e=s.value.fields;a<e.length-1&&([e[a],e[a+1]]=[e[a+1],e[a]])}function Q(a,e){a.enum_values=e.split("|").map(l=>l.trim()).filter(Boolean)}async function H(){p.value="",v.value=!0;try{const a=s.value.fields.filter(e=>e.name.trim());c.value=await k.previewDomain({...s.value,fields:a}),w.value=!0}catch(a){p.value=a.message}finally{v.value=!1}}async function K(){p.value="",v.value=!0,P.value=!1,F.value="",T.value="";try{const a=s.value.fields.filter(e=>e.name&&e.type);c.value=await k.generateDomain({...s.value,fields:a}),w.value=!0,await S(),c.value.success&&(O(c.value.message||"ç”ŸæˆæˆåŠŸï¼"),await W())}catch(a){p.value=a.message}finally{v.value=!1}}const P=u(!1),F=u(""),T=u("");async function W(){P.value=!0,F.value="",T.value="";try{const l=(await(await fetch("/api/layout")).json()).module_dir||".";console.log("Running go mod tidy for:",l);const i=await(await fetch("/api/projects/tidy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_path:l})})).json();console.log("Tidy result:",i),i.success?F.value=i.message||"ä¾èµ–ä¸‹è½½æˆåŠŸ":(T.value=i.error||"ä¾èµ–ä¸‹è½½å¤±è´¥",i.output&&(F.value=i.output))}catch(a){console.error("Tidy error:",a),T.value=`ä¾èµ–ä¸‹è½½å¤±è´¥: ${a.message}`}finally{P.value=!1}}function G(){s.value={name:"",fields:[{name:"",type:"string",enum_values:[]}],table_name:"",route_base:"",soft_delete:!1,wire:!0,force:!1},c.value=null,w.value=!1,$.value=null}function X(a){return{new:"æ–°å»º",overwrite:"è¦†ç›–",skip:"è·³è¿‡",error:"é”™è¯¯"}[a]||a}return(a,e)=>(n(),o(b,null,[t("div",ne,[e[28]||(e[28]=t("h1",null,"ğŸ“¦ ç”Ÿæˆé¢†åŸŸæ¨¡å— Domain",-1)),t("div",ie,[t("button",{class:E(["tab",{active:g.value==="new"}]),onClick:e[0]||(e[0]=l=>g.value="new")}," âœ¨ æ–°å»ºæ¨¡å— ",2),t("button",{class:E(["tab",{active:g.value==="existing"}]),onClick:e[1]||(e[1]=l=>g.value="existing")}," ğŸ“‹ å·²ç”Ÿæˆæ¨¡å— ("+r(h.value?.length||0)+") ",3)]),g.value==="existing"?(n(),o("div",de,[t("div",ue,[m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),type:"text",placeholder:"ğŸ” æœç´¢é¢†åŸŸæ¨¡å—æˆ–å­—æ®µ...",class:"search-input"},null,512),[[U,y.value]]),y.value?(n(),o("span",{key:0,class:"search-clear",onClick:e[3]||(e[3]=l=>y.value="")},"âœ•")):f("",!0)]),j.value?(n(),o("div",re,"åŠ è½½ä¸­...")):N.value.length===0&&!y.value?(n(),o("div",ve,[...e[14]||(e[14]=[t("p",null,"æš‚æ— å·²ç”Ÿæˆçš„é¢†åŸŸæ¨¡å—",-1),t("p",{class:"hint"},'ç‚¹å‡»"æ–°å»ºæ¨¡å—"å¼€å§‹åˆ›å»º',-1)])])):N.value.length===0&&y.value?(n(),o("div",ce,[...e[15]||(e[15]=[t("p",null,"æœªæ‰¾åˆ°åŒ¹é…çš„æ¨¡å—",-1),t("p",{class:"hint"},"å°è¯•å…¶ä»–å…³é”®è¯",-1)])])):(n(),o("div",fe,[(n(!0),o(b,null,V(N.value,l=>(n(),o("div",{key:l.name,class:"domain-card",onClick:d=>x(l.name)},[t("div",pe,[t("h3",null,r(l.name),1),t("div",ye,[t("span",ge,r(l.fields?.length||0)+" å­—æ®µ",1),t("button",{class:"btn-delete",onClick:d=>R(l.name,d),title:"åˆ é™¤æ¨¡å—"}," ğŸ—‘ï¸ ",8,_e)])]),t("div",be,[(n(!0),o(b,null,V(l.fields,(d,i)=>(n(),o("span",{key:i,class:"field-tag"},r(d),1))),128))]),e[16]||(e[16]=t("div",{class:"domain-action"}," ç‚¹å‡»ç¼–è¾‘ â†’ ",-1))],8,me))),128))]))])):f("",!0),g.value==="new"?(n(),o("div",ke,[$.value?(n(),o("div",we,[e[17]||(e[17]=_(" âœï¸ æ­£åœ¨ç¼–è¾‘: ",-1)),t("strong",null,r($.value),1),t("button",{class:"btn-small",onClick:G},"å–æ¶ˆç¼–è¾‘")])):f("",!0),t("div",he,[t("div",Ce,[e[27]||(e[27]=te('<details class="help-tips" data-v-a10def95><summary data-v-a10def95>ğŸ“– ä½¿ç”¨æŒ‡å— Usage Guide</summary><div class="tips-content" data-v-a10def95><p data-v-a10def95><strong data-v-a10def95>é¢†åŸŸåç§°ï¼š</strong>ä½¿ç”¨ PascalCase æ ¼å¼ï¼Œå¦‚ <code data-v-a10def95>User</code>ã€<code data-v-a10def95>Order</code></p><p data-v-a10def95><strong data-v-a10def95>å­—æ®µç±»å‹ï¼š</strong></p><ul data-v-a10def95><li data-v-a10def95><code data-v-a10def95>string</code> - å­—ç¬¦ä¸² (varchar 255)</li><li data-v-a10def95><code data-v-a10def95>text</code> - é•¿æ–‡æœ¬</li><li data-v-a10def95><code data-v-a10def95>int</code> / <code data-v-a10def95>int64</code> - æ•´æ•°</li><li data-v-a10def95><code data-v-a10def95>time</code> - æ—¶é—´æˆ³ï¼Œ<code data-v-a10def95>time?</code> - å¯é€‰æ—¶é—´</li><li data-v-a10def95><code data-v-a10def95>enum</code> - æšä¸¾ç±»å‹ï¼Œéœ€å¡«å†™æšä¸¾å€¼ï¼ˆç”¨ | åˆ†éš”ï¼‰</li></ul><p data-v-a10def95><strong data-v-a10def95>æ³¨æ„ï¼š</strong></p><ul data-v-a10def95><li data-v-a10def95>IDã€CreatedAtã€UpdatedAt å­—æ®µè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ </li><li data-v-a10def95>ä½¿ç”¨ â†‘â†“ æŒ‰é’®å¯è°ƒæ•´å­—æ®µé¡ºåº</li><li data-v-a10def95>å‹¾é€‰&quot;å¼ºåˆ¶è¦†ç›–&quot;ä¼šå®Œå…¨æ›¿æ¢ç°æœ‰ä»£ç ï¼Œè¯·è°¨æ…ä½¿ç”¨</li><li data-v-a10def95>ç”Ÿæˆåä¼šè‡ªåŠ¨è¿è¡Œ go mod tidy ä¸‹è½½ä¾èµ–</li></ul></div></details>',1)),t("div",De,[e[18]||(e[18]=t("label",null,[_(" é¢†åŸŸåç§° Domain Name * "),t("span",{class:"tooltip","data-tooltip":"å®ä½“åç§°ï¼Œå°†ç”Ÿæˆå¯¹åº”çš„ Go ç»“æ„ä½“"},"â“˜")],-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.name=l),placeholder:"User / Order / Product"},null,512),[[U,s.value.name]])]),t("div",Ue,[t("div",{class:"section-header"},[e[19]||(e[19]=t("h3",null,"å­—æ®µ Fields",-1)),t("button",{class:"btn-add",onClick:I},"+ æ·»åŠ å­—æ®µ")]),(n(!0),o(b,null,V(s.value.fields,(l,d)=>(n(),o("div",{class:"field-row",key:d},[m(t("input",{"onUpdate:modelValue":i=>l.name=i,placeholder:"username / email / status",class:"field-name"},null,8,Ve),[[U,l.name]]),m(t("select",{"onUpdate:modelValue":i=>l.type=i,class:"field-type"},[(n(!0),o(b,null,V(B.value,i=>(n(),o("option",{key:i.type,value:i.type},r(i.type)+" - "+r(i.description),9,Fe))),128))],8,$e),[[le,l.type]]),l.type==="enum"?(n(),o("input",{key:0,value:l.enum_values?.join("|"),onInput:i=>Q(l,i.target.value),placeholder:"active|inactive|banned",class:"field-enum","data-tooltip":"æšä¸¾å€¼ç”¨ | åˆ†éš”ï¼Œå¦‚ï¼šactive|inactive"},null,40,Te)):f("",!0),t("div",je,[t("button",{class:"btn-move",onClick:i=>z(d),disabled:d===0,title:"ä¸Šç§»"},"â†‘",8,Ne),t("button",{class:"btn-move",onClick:i=>J(d),disabled:d===s.value.fields.length-1,title:"ä¸‹ç§»"},"â†“",8,Se),t("button",{class:"btn-remove",onClick:i=>L(d),disabled:s.value.fields.length===1},"Ã—",8,Pe)])]))),128))]),t("div",Ee,[t("div",Me,[t("label",Be,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.soft_delete=l)},null,512),[[M,s.value.soft_delete]]),e[20]||(e[20]=_(" å¯ç”¨è½¯åˆ é™¤ Soft Delete ",-1))])]),t("div",Ge,[t("label",Oe,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>s.value.wire=l)},null,512),[[M,s.value.wire]]),e[21]||(e[21]=_(" è‡ªåŠ¨æ³¨å…¥åˆ° main.go ",-1))])]),t("div",Re,[t("label",qe,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>s.value.force=l)},null,512),[[M,s.value.force]]),e[22]||(e[22]=_(" å¼ºåˆ¶è¦†ç›– Force ",-1))])])]),s.value.force?(n(),o("div",xe,[...e[23]||(e[23]=[t("div",{class:"warning-icon"},"âš ï¸",-1),t("div",{class:"warning-content"},[t("strong",null,"è­¦å‘Šï¼šå¼ºåˆ¶è¦†ç›–å°†æ°¸ä¹…åˆ é™¤æ‰€æœ‰æ‰‹åŠ¨ä¿®æ”¹çš„ä»£ç ï¼"),t("p",null,"åªåœ¨é¦–æ¬¡ç”Ÿæˆåç«‹å³ä¿®æ”¹å­—æ®µæ—¶ä½¿ç”¨ã€‚ä¸€æ—¦å¼€å§‹å†™ä¸šåŠ¡é€»è¾‘ï¼Œè¯·å‹¿å‹¾é€‰æ­¤é€‰é¡¹ã€‚")],-1)])])):f("",!0),t("details",Ae,[e[26]||(e[26]=t("summary",null,"é«˜çº§é€‰é¡¹ Advanced",-1)),t("div",Ie,[e[24]||(e[24]=t("label",null,"è‡ªå®šä¹‰è¡¨å Table Name",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.table_name=l),placeholder:"ï¼ˆè‡ªåŠ¨ï¼šåç§°çš„å¤æ•°å½¢å¼ï¼‰"},null,512),[[U,s.value.table_name]])]),t("div",Le,[e[25]||(e[25]=t("label",null,"è‡ªå®šä¹‰è·¯ç”±å‰ç¼€ Route Base",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.route_base=l),placeholder:"ï¼ˆè‡ªåŠ¨ï¼šåç§°çš„å¤æ•°å½¢å¼ï¼‰"},null,512),[[U,s.value.route_base]])])]),p.value?(n(),o("div",ze,r(p.value),1)):f("",!0),t("div",Je,[t("button",{class:"btn",onClick:H,disabled:!s.value.name||v.value},r(v.value?"åŠ è½½ä¸­...":"é¢„è§ˆ Preview"),9,Qe),t("button",{class:"btn primary",onClick:K,disabled:!s.value.name||v.value},r(v.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆ Generate"),9,He)])]),w.value&&c.value?(n(),o("div",Ke,[t("div",We,[t("h3",null,r(c.value.success?"âœ… å·²ç”Ÿæˆæ–‡ä»¶":"âŒ é”™è¯¯"),1),t("button",{class:"btn-close",onClick:e[10]||(e[10]=l=>w.value=!1)},"Ã—")]),t("div",Xe,[(n(!0),o(b,null,V(c.value.files,l=>(n(),o("div",{class:"file",key:l.path},[t("span",{class:E(["file-status",l.status])},r(X(l.status)),3),t("span",Ye,r(l.path.split("/").pop()),1)]))),128))]),c.value.message?(n(),o("div",Ze,r(c.value.message),1)):f("",!0),t("button",{class:"btn primary",onClick:G,style:{width:"100%","margin-top":"16px"}}," ç”Ÿæˆå¦ä¸€ä¸ª ")])):f("",!0)])])):f("",!0)]),C.value?(n(),o("div",{key:0,class:"modal-overlay",onClick:e[13]||(e[13]=l=>C.value=!1)},[t("div",{class:"modal-dialog",onClick:e[12]||(e[12]=ae(()=>{},["stop"]))},[e[31]||(e[31]=t("div",{class:"modal-icon"},"âš ï¸",-1)),e[32]||(e[32]=t("h3",null,"ç¡®è®¤åˆ é™¤",-1)),t("p",et,[e[29]||(e[29]=_(" ç¡®å®šè¦åˆ é™¤é¢†åŸŸæ¨¡å— ",-1)),t("strong",null,'"'+r(D.value)+'"',1),e[30]||(e[30]=_(" å—ï¼Ÿ ",-1))]),e[33]||(e[33]=t("p",{class:"modal-warning"}," è¿™å°†åˆ é™¤æ•´ä¸ªç›®å½•åŠå…¶æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼ ",-1)),t("div",tt,[t("button",{class:"btn",onClick:e[11]||(e[11]=l=>C.value=!1)},"å–æ¶ˆ"),t("button",{class:"btn danger",onClick:q},"ç¡®è®¤åˆ é™¤")])])])):f("",!0)],64))}}),it=se(at,[["__scopeId","data-v-a10def95"]]);export{it as default};
