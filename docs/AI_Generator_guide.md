# AI + Generator 联合开发操作手册

## 1. 目标与原则
- **Generator 负责骨架**：标准化结构、模板代码、脚手架、可重复的 CRUD 和 DDD 组件。
- **AI 负责智能增强**：需求澄清、业务规则、接口设计、边界条件、测试策略、文档与审查建议。
- **人类负责决策**：领域边界、命名规范、优先级、上线策略与最终验收。

---

## 2. 环境准备
- 已安装 `soliton-gen`（可用 `soliton-gen serve` 启动 GUI）。
- 确保在 **项目根目录**（含 `go.mod`）运行生成器。
- 建议初始化 Git 仓库，便于回滚与 diff。

---

## 3. 推荐开发流程（迭代节奏）
### Step 0：需求拆解（AI）
- 输入业务背景、目标、关键流程、核心实体给 AI。
- 产出：领域划分、实体/值对象/事件/服务建议清单。

### Step 1：领域模块生成（Generator）
- 用 GUI 的「领域模块」生成领域（Entity/Repository/Events）。
- 先生成“主流程核心领域”，再逐步覆盖边缘领域。
- 建议填写**领域备注**，用于卡片展示与后续检索。

### Step 2：DDD 增强（Generator）
- 在「领域增强 DDD」生成：
  - Value Object / Specification / Policy / Event & Handler
- 使用 **Diff 对比**确认覆盖结果。
- 用“批量导入”快速贴入字段定义或 JSON。

### Step 3：应用服务生成（Generator）
- 在「服务编辑器」生成应用服务与方法骨架。
- 先生成主用例方法，再扩展边界方法。
- 建议填写**服务备注**，便于理解服务用途。
- 方法可填写**备注**，用于说明用途，生成后可回显。

### Step 4：AI 补全逻辑与接口
- AI 负责：
  - 业务规则实现
  - DTO/VO 设计
  - 接口输入输出字段确认
  - 错误处理策略、日志、边界条件

### Step 5：本地运行与验证
- 运行单元测试/接口测试
- 结合 AI 做代码审查，发现潜在缺陷
- 结合 Generator Diff，避免无意覆盖

---

## 4. 协作方式建议（AI + Generator）
**推荐做法：**
1. **用 AI 先推导模型** → 再生成结构
2. **Generator 先出骨架** → AI 逐层补业务
3. **每个阶段生成后都 git commit**
4. **Diff 预览确保不会误覆盖**

---

## 5. 常用输入模板（可直接给 AI）
### 业务描述模板
```
领域：订单(Order)
目标：支持下单、支付、取消、退款
关键流程：下单 -> 支付成功 -> 发货
约束：超时未支付自动取消
```

### DDD 设计模板
```
需要的实体：Order, Payment
值对象：Money, Address
事件：OrderPlaced, PaymentSucceeded
策略：RefundPolicy
规格：ActiveOrderSpec
```

---

## 6. 注意事项（重点）
- **命名规范**：领域/组件统一 PascalCase；目录为小写。
- **Force 覆盖**：仅在确认无手工修改后使用。
- **Diff 对比**：在覆盖前必须预览。
- **事件与处理器**：Handler 可能涉及 module 注册；重命名要注意事件注册同步。
- **批量导入**：建议保持一致格式（JSON 或 `name,type,comment`）。
- **AI 输出代码**：需人工判断可维护性，不可无脑粘贴。

---

## 7. 质量保障建议
- 对关键业务路径补上测试：
  - 单元测试：领域规则/策略/规格
  - 集成测试：服务调用链
- AI 辅助代码审查：
  - 边界条件/空值/并发
  - 错误传播/日志完整性
  - 依赖与事务边界

---

## 8. 常见问题
**Q: 为什么 DDD 下拉列表为空？**  
A: 确保领域文件已生成，且 `soliton-gen serve` 在项目根目录启动。

**Q: 批量导入不生效？**  
A: 检查 JSON 是否标准；行格式需 `name,type,comment`。

**Q: 覆盖后代码丢失？**  
A: 使用 Force 前必须 Diff，建议先 git commit。

---

## 9. 推荐迭代节奏（节奏模板）
**T1（生成骨架）** → **T2（AI 填业务）** → **T3（人工审核+测试）** → **T4（再生成/调整）** → 循环
